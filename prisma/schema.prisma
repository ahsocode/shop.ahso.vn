generator client {
  provider = "prisma-client"
  output   = "../generated"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  STAFF
  ADMIN
}

model User {
  id               String   @id @default(cuid())
  username         String   @unique
  passwordHash     String
  fullName         String
  email            String   @unique
  phoneE164        String   @unique
  taxCode          String?  @db.VarChar(13)
  emailVerified    Boolean  @default(false)
  role             Role     @default(USER)
  avatarUrl        String?  @default("/logo.png")  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  shippingAddressId String  @unique
  billingAddressId  String? @unique

  shippingAddress Address  @relation("ShippingAddress", fields: [shippingAddressId], references: [id])
  billingAddress  Address? @relation("BillingAddress", fields: [billingAddressId], references: [id])
}


model Address {
  id         String   @id @default(cuid())
  line1      String
  line2      String?
  city       String
  state      String?
  postalCode String?
  country    String   @db.Char(2)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  usersShipping User[] @relation("ShippingAddress")
  usersBilling  User[] @relation("BillingAddress")
}